

// // // ajanda.js (tam d√ºzeltilmi≈ü ve geli≈ütirilmi≈ü s√ºr√ºm)
// // // -----------------------------------------------------------------------------
// // // Bu dosya, hafta/ay g√∂r√ºn√ºm√º arasƒ±nda ge√ßi≈ü yapabilen, Pazartesi ba≈ülangƒ±√ßlƒ±
// // // takvim ƒ±zgarasƒ± ve √∂ƒürenci/randevu listeleri olan Ajanda ekranƒ±nƒ± i√ßerir.
// // //
// // // üîß Ana d√ºzeltmeler:
// // // 1) Takvim ƒ±zgarasƒ± tam 7 s√ºtun (Pazar dahil) g√∂sterecek ≈üekilde d√ºzeltildi
// // // 2) Ay/Hafta g√∂r√ºn√ºm√º arasƒ±nda switch ile ge√ßi≈ü eklendi
// // // 3) Yeni randevu butonu se√ßili tarihi "ajandaKayitEkle" sayfasƒ±na prop olarak g√∂nderiyor
// // // 4) T√ºm matematiksel hesaplamalar ve React hook kullanƒ±mlarƒ± a√ßƒ±klandƒ±
// // // -----------------------------------------------------------------------------

// // import React, { useState, useEffect } from 'react';
// // import {
// //     View,
// //     Text,
// //     StyleSheet,
// //     ScrollView,
// //     TouchableOpacity,
// //     FlatList,
// //     Modal,
// //     TouchableWithoutFeedback,
// //     Dimensions,
// //     ActivityIndicator,
// //     Switch,
// // } from 'react-native';
// // import { useNavigation, useIsFocused } from '@react-navigation/native';
// // import { MaterialIcons, FontAwesome5 } from '@expo/vector-icons';
// // import { ogrencileriListele } from '../utils/database';
// // import { gunlukAjandaGetir } from '../utils/ajandaDatabase';

// // // üìê Ekran geni≈üliƒüi hesaplamasƒ±
// // // Dimensions.get('window').width: cihazƒ±n tam ekran geni≈üliƒüi
// // // - 30: sol ve saƒü padding (15+15)
// // // / 7: haftanƒ±n 7 g√ºn√º i√ßin e≈üit b√∂l√º≈üt√ºr
// // const { width } = Dimensions.get('window');
// // const CELL_WIDTH = (width - 30) / 7;

// // // üìÖ Haftanƒ±n g√ºn isimleri (Pazartesi ba≈ülangƒ±√ßlƒ±)
// // // Bu dizi hem ba≈ülƒ±k satƒ±rƒ±nda hem de g√ºn hesaplamalarƒ±nda kullanƒ±lƒ±r
// // const DAY_NAMES = ['Pt', 'Sa', '√áa', 'Pe', 'Cu', 'Ct', 'Pz'];

// // // üîÑ JavaScript Date.getDay() d√∂n√º≈üt√ºr√ºc√º fonksiyon
// // // JS'de: 0=Pazar, 1=Pazartesi, 2=Salƒ±... 6=Cumartesi
// // // Bizim istediƒüimiz: 0=Pazartesi, 1=Salƒ±... 6=Pazar
// // // Form√ºl: Pazar(0) -> 6'ya √ßevir, diƒüerleri 1 eksilt
// // const getDayIndex = (date) => {
// //     const jsDay = date.getDay(); // JavaScript'in orijinal g√ºn√º
// //     return jsDay === 0 ? 6 : jsDay - 1;
// // };

// // // üìÜ Verilen tarihten o haftanƒ±n Pazartesi'sini bulan fonksiyon
// // // √ñrnek: √áar≈üamba verilirse, o haftanƒ±n Pazartesi'sini d√∂nd√ºr√ºr
// // const getMonday = (date) => {
// //     const dayIndex = getDayIndex(date); // Pazartesi=0 bazƒ±nda g√ºn indeksi
// //     const monday = new Date(date); // Orijinal tarihi kopyala
// //     monday.setDate(date.getDate() - dayIndex); // Geri git ve Pazartesi'yi bul
// //     return monday;
// // };




// // export default function Ajanda() {
// //     // üß≠ React Navigation hook'u
// //     // useNavigation(): ba≈üka sayfalara ge√ßi≈ü yapabilmek i√ßin navigation objesi d√∂nd√ºr√ºr
// //     const navigation = useNavigation();

// //     // üëÅÔ∏è Sayfa odak durumu hook'u  
// //     // useIsFocused(): bu sayfa aktif/g√∂r√ºn√ºr olduƒüunda true d√∂nd√ºr√ºr
// //     // Genellikle sayfa geri geldiƒüinde veri tazelemek i√ßin kullanƒ±lƒ±r
// //     const isFocused = useIsFocused();

// //     // üè™ React State (useState hook) tanƒ±mlamalarƒ±
// //     // useState(ba≈ülangƒ±√ßDeƒüer): [deƒüer, deƒüerDeƒüi≈ütirFonksiyonu] d√∂nd√ºr√ºr
// //     const [selectedDate, setSelectedDate] = useState(new Date()); // Se√ßili tarih
// //     const [currentMonth, setCurrentMonth] = useState(new Date()); // Ay g√∂r√ºn√ºm√ºndeki ay
// //     const [currentWeek, setCurrentWeek] = useState(getMonday(new Date())); // Hafta g√∂r√ºn√ºm√ºndeki hafta
// //     const [isWeekView, setIsWeekView] = useState(false); // Hafta mƒ± ay mƒ± g√∂r√ºn√ºm√º
// //     const [showOgrenciList, setShowOgrenciList] = useState(false); // √ñƒürenci modal'ƒ±nƒ±n a√ßƒ±k/kapalƒ± durumu
// //     const [randevular, setRandevular] = useState([]); // Se√ßili g√ºn√ºn randevu listesi
// //     const [ogrenciler, setOgrenciler] = useState([]); // T√ºm √∂ƒürenci listesi
// //     const [calendarDays, setCalendarDays] = useState([]); // Takvimde g√∂sterilecek g√ºnler
// //     const [loading, setLoading] = useState(true); // Y√ºklenme durumu

// //     // üîÑ useEffect Hook'larƒ±
// //     // useEffect(fonksiyon, baƒüƒ±mlƒ±lƒ±kDizisi): baƒüƒ±mlƒ±lƒ±k deƒüi≈ütiƒüinde fonksiyonu √ßalƒ±≈ütƒ±rƒ±r
// //     // [] bo≈ü dizi: sadece component ilk y√ºklendiƒüinde √ßalƒ±≈ütƒ±r
// //     // [deƒüi≈üken]: o deƒüi≈üken deƒüi≈ütiƒüinde √ßalƒ±≈ütƒ±r

// //     // Takvim g√∂r√ºn√ºm√º deƒüi≈ütiƒüinde g√ºnleri yeniden hesapla
// //     useEffect(() => {
// //         if (isWeekView) {
// //             generateWeekDays(); // Hafta g√∂r√ºn√ºm√º i√ßin 7 g√ºn
// //         } else {
// //             generateCalendarDaysMonth(); // Ay g√∂r√ºn√ºm√º i√ßin 42 g√ºn
// //         }
// //     }, [currentMonth, currentWeek, isWeekView]);

// //     // Sayfa odaklandƒ±ƒüƒ±nda √∂ƒürenci listesini tazele
// //     useEffect(() => {
// //         if (isFocused) {
// //             fetchOgrenciler();
// //         }
// //     }, [isFocused]);

// //     // üîó Asenkron fonksiyon: Veritabanƒ±ndan √∂ƒürenci listesi √ßekme
// //     // async/await: Promise tabanlƒ± asenkron i≈ülemler i√ßin modern JS syntaxƒ±
// //     // try/catch: hata yakalama bloƒüu
// //     const fetchOgrenciler = async () => {
// //         try {
// //             setLoading(true); // Y√ºklenme ba≈üladƒ±
// //             const result = await ogrencileriListele(false); // DB fonksiyonunu bekle
// //             // Optional chaining (?.): result null/undefined ise hata vermez
// //             if (result?.success) {
// //                 // Logical OR (||): sol taraf falsy ise saƒü tarafƒ± kullan
// //                 setOgrenciler(result.data || []);
// //             }
// //         } catch (error) {
// //             // console.error: hatalarƒ± konsola yazdƒ±r (geli≈ütirme ama√ßlƒ±)
// //             console.error('√ñƒürenci listesi alƒ±namadƒ±:', error);
// //         } finally {
// //             // finally bloƒüu: hata olsun olmasƒ±n her durumda √ßalƒ±≈üƒ±r
// //             setLoading(false); // Y√ºklenme bitti
// //         }
// //     };

// //     // üìÖ AY G√ñR√úN√úM√ú: 42 h√ºcrelik (6 hafta x 7 g√ºn) takvim ƒ±zgarasƒ± olu≈üturma
// //     // Bu fonksiyon, bir ayƒ±n t√ºm g√ºnlerini + √∂nceki/sonraki aydan eksik g√ºnleri
// //     // toplamda 42 h√ºcre olacak ≈üekilde hesaplar
// //     const generateCalendarDaysMonth = () => {
// //         // Date objesi metodlarƒ±:
// //         // getFullYear(): 2024 gibi 4 haneli yƒ±l
// //         // getMonth(): 0-11 arasƒ± ay indeksi (0=Ocak, 11=Aralƒ±k)
// //         const year = currentMonth.getFullYear();
// //         const month = currentMonth.getMonth();

// //         // new Date(yƒ±l, ay, g√ºn) constructor'ƒ±:
// //         // - g√ºn=1: ayƒ±n ilk g√ºn√º
// //         // - g√ºn=0: √∂nceki ayƒ±n son g√ºn√º (JavaScript √∂zelliƒüi)
// //         const firstDay = new Date(year, month, 1); // Bu ayƒ±n 1'i
// //         const lastDay = new Date(year, month + 1, 0); // Bu ayƒ±n son g√ºn√º

// //         // getDayIndex: kendi yazdƒ±ƒüƒ±mƒ±z fonksiyon (Pazartesi=0 bazƒ±nda)
// //         const firstDayIndex = getDayIndex(firstDay);

// //         const days = []; // Sonu√ß dizisi
// //         const today = new Date(); // Bug√ºn√ºn tarihi

// //         // 1Ô∏è‚É£ √ñNCEKƒ∞ AYDAN G√úNLER
// //         // Eƒüer ayƒ±n 1'i √áar≈üamba ise (index=2), ba≈üa 2 g√ºn eklememiz gerekir
// //         // √ñnceki ayƒ±n son g√ºn√º: new Date(year, month, 0).getDate()
// //         const prevMonthLastDate = new Date(year, month, 0).getDate();
// //         for (let i = firstDayIndex; i > 0; i--) {
// //             // Geriye doƒüru say: prevMonthLastDate-1, prevMonthLastDate-2, ...
// //             const date = new Date(year, month - 1, prevMonthLastDate - i + 1);
// //             days.push({
// //                 date,
// //                 isCurrentMonth: false, // Mevcut ay deƒüil
// //                 isToday: false, // √ñnceki ay olduƒüu i√ßin bug√ºn olamaz
// //                 hasEvent: Math.random() > 0.85, // Demo: d√º≈ü√ºk olasƒ±lƒ±kla etkinlik
// //             });
// //         }

// //         // 2Ô∏è‚É£ BU AYDAN G√úNLER
// //         // 1'den son g√ºne kadar t√ºm g√ºnleri ekle
// //         for (let d = 1; d <= lastDay.getDate(); d++) {
// //             const date = new Date(year, month, d);
// //             days.push({
// //                 date,
// //                 isCurrentMonth: true,
// //                 // toDateString(): tarih kar≈üƒ±la≈ütƒ±rmasƒ± (saat olmadan)
// //                 // "Mon Aug 31 2025" formatƒ±nda string d√∂nd√ºr√ºr
// //                 isToday: date.toDateString() === today.toDateString(),
// //                 hasEvent: Math.random() > 0.5, // Demo: %50 olasƒ±lƒ±k
// //             });
// //         }

// //         // 3Ô∏è‚É£ SONRAKƒ∞ AYDAN G√úNLER
// //         // Toplam 42 h√ºcre olacak ≈üekilde kalan yerleri doldur
// //         const totalCells = 42; // 6 hafta x 7 g√ºn = 42
// //         const remainingCells = totalCells - days.length;
// //         for (let i = 1; i <= remainingCells; i++) {
// //             const date = new Date(year, month + 1, i);
// //             days.push({
// //                 date,
// //                 isCurrentMonth: false,
// //                 isToday: false,
// //                 hasEvent: Math.random() > 0.85, // Demo
// //             });
// //         }

// //         setCalendarDays(days);
// //     };

// //     // üìÖ HAFTA G√ñR√úN√úM√ú: 7 g√ºnl√ºk sƒ±ralƒ± liste olu≈üturma
// //     // currentWeek state'inde tutulan Pazartesi'den ba≈ülayarak 7 g√ºn √ºret
// //     const generateWeekDays = () => {
// //         const days = [];
// //         const today = new Date();

// //         // for d√∂ng√ºs√º: 0'dan 6'ya kadar (7 g√ºn)
// //         for (let i = 0; i < 7; i++) {
// //             // new Date(currentWeek): mevcut hafta Pazartesi'sini kopyala
// //             // setDate(): g√ºn sayƒ±sƒ±nƒ± deƒüi≈ütir (i g√ºn sonrasƒ±nƒ± al)
// //             const date = new Date(currentWeek);
// //             date.setDate(currentWeek.getDate() + i);

// //             days.push({
// //                 date,
// //                 isCurrentMonth: true, // Hafta g√∂r√ºn√ºm√ºnde hep true
// //                 isToday: date.toDateString() === today.toDateString(),
// //                 hasEvent: Math.random() > 0.5, // Demo
// //             });
// //         }

// //         setCalendarDays(days);
// //     };

// //     // üóìÔ∏è Ay formatlamasƒ± fonksiyonu
// //     // toLocaleDateString(): tarih formatlamasƒ± i√ßin JavaScript metodu
// //     // 'tr-TR': T√ºrk√ße locale (yerel ayar)
// //     // options objesi: hangi par√ßalarƒ±n g√∂sterileceƒüini belirler
// //     const formatMonth = (date) =>
// //         date.toLocaleDateString('tr-TR', {
// //             month: 'long',  // "Aƒüustos" (uzun format)
// //             year: 'numeric' // "2025" (sayƒ±sal)
// //         });

// //     // üìÜ Hafta formatlamasƒ± fonksiyonu  
// //     // Haftanƒ±n ilk ve son g√ºnlerini g√∂ster: "1-7 Aƒüustos 2025"
// //     const formatWeek = (mondayDate) => {
// //         const sunday = new Date(mondayDate);
// //         sunday.setDate(mondayDate.getDate() + 6); // 6 g√ºn sonrasƒ± = Pazar

// //         // ƒ∞ki tarih aynƒ± ay i√ßindeyse
// //         if (mondayDate.getMonth() === sunday.getMonth()) {
// //             return `${mondayDate.getDate()}-${sunday.getDate()} ${formatMonth(mondayDate)}`;
// //         } else {
// //             // Farklƒ± aylardaysa her ikisini de g√∂ster
// //             return `${mondayDate.toLocaleDateString('tr-TR', { day: 'numeric', month: 'short' })} - ${sunday.toLocaleDateString('tr-TR', { day: 'numeric', month: 'short', year: 'numeric' })}`;
// //         }
// //     };

// //     // ‚¨ÖÔ∏è‚û°Ô∏è Ay deƒüi≈ütirme fonksiyonu
// //     // direction parametresi: -1 (√∂nceki ay) veya +1 (sonraki ay)
// //     const changeMonth = (direction) => {
// //         const nextMonth = new Date(currentMonth); // Mevcut ayƒ± kopyala
// //         nextMonth.setMonth(nextMonth.getMonth() + direction); // Ay ekle/√ßƒ±kar
// //         setCurrentMonth(nextMonth); // State'i g√ºncelle

// //         // Se√ßili tarih, yeni ay i√ßinde deƒüilse, ayƒ±n 1'ini se√ß
// //         if (selectedDate.getMonth() !== nextMonth.getMonth() ||
// //             selectedDate.getFullYear() !== nextMonth.getFullYear()) {
// //             setSelectedDate(new Date(nextMonth.getFullYear(), nextMonth.getMonth(), 1));
// //         }
// //     };

// //     // ‚¨ÖÔ∏è‚û°Ô∏è Hafta deƒüi≈ütirme fonksiyonu
// //     // direction: -1 (√∂nceki hafta) veya +1 (sonraki hafta)
// //     const changeWeek = (direction) => {
// //         const nextWeek = new Date(currentWeek); // Mevcut hafta Pazartesi'sini kopyala
// //         nextWeek.setDate(currentWeek.getDate() + (direction * 7)); // 7 g√ºn ekle/√ßƒ±kar
// //         setCurrentWeek(nextWeek);

// //         // Se√ßili g√ºn√º de aynƒ± y√∂nde kaydƒ±r
// //         const newSelectedDate = new Date(selectedDate);
// //         newSelectedDate.setDate(selectedDate.getDate() + (direction * 7));
// //         setSelectedDate(newSelectedDate);
// //     };

// //     // üîÄ G√∂r√ºn√ºm deƒüi≈ütirme fonksiyonu (Switch component i√ßin)
// //     // value parametresi: Switch'in yeni deƒüeri (true=hafta, false=ay)
// //     const toggleView = (value) => {
// //         setIsWeekView(value);

// //         if (value) {
// //             // Hafta g√∂r√ºn√ºm√ºne ge√ßi≈ü: se√ßili g√ºn√º i√ßeren haftanƒ±n Pazartesi'sini bul
// //             setCurrentWeek(getMonday(selectedDate));
// //         } else {
// //             // Ay g√∂r√ºn√ºm√ºne ge√ßi≈ü: se√ßili g√ºn√ºn ayƒ±nƒ± mevcut ay yap
// //             setCurrentMonth(new Date(selectedDate.getFullYear(), selectedDate.getMonth(), 1));
// //         }
// //     };

// //     // üëÜ G√ºn se√ßme fonksiyonu
// //     // day parametresi: renderCalendarDay fonksiyonundan gelen g√ºn objesi
// //     const selectDay = (day) => {
// //         setSelectedDate(day.date); // Se√ßili tarihi g√ºncelle

// //         // TODO: Ger√ßek uygulamada burada se√ßilen g√ºn√ºn randevularƒ±nƒ± √ßekebilirsiniz
// //         // fetchRandevularForDate(day.date);

// //         // Demo ama√ßlƒ± rastgele randevu listesi
// //         setRandevular([
// //             {
// //                 id: 1,
// //                 saat: '14:00',
// //                 ogrenciAdi: 'Ahmet Yƒ±lmaz',
// //                 ders: 'Matematik',
// //                 tamamlandi: false
// //             },
// //             {
// //                 id: 2,
// //                 saat: '16:00',
// //                 ogrenciAdi: 'Ay≈üe Demir',
// //                 ders: 'Fizik',
// //                 tamamlandi: true
// //             }
// //         ]);
// //     };

// //     // üé® FlatList renderItem fonksiyonu: Randevu listesi
// //     // FlatList'te her √∂ƒüe i√ßin bu fonksiyon √ßaƒürƒ±lƒ±r
// //     // { item }: destructuring syntax - sadece item √∂zelliƒüini al
// //     const renderRandevuItem = ({ item }) => (
// //         <View style={[
// //             styles.randevuItem,
// //             // Conditional styling: tamamlandƒ±ysa farklƒ± stil uygula
// //             item.tamamlandi && styles.tamamlandiItem
// //         ]}>
// //             {/* Randevu saati kutusu */}
// //             <View style={styles.randevuSaat}>
// //                 <Text style={styles.randevuSaatText}>{item.saat}</Text>
// //             </View>

// //             {/* √ñƒürenci ve ders bilgisi */}
// //             <View style={styles.randevuBilgi}>
// //                 <Text style={styles.randevuOgrenci}>{item.ogrenciAdi}</Text>
// //                 <Text style={styles.randevuDers}>{item.ders}</Text>
// //             </View>

// //             {/* Durum ikonu */}
// //             <View style={styles.randevuDurum}>
// //                 {item.tamamlandi ? (
// //                     <MaterialIcons name="check-circle" size={24} color="#27ae60" />
// //                 ) : (
// //                     <MaterialIcons name="schedule" size={24} color="#f39c12" />
// //                 )}
// //             </View>
// //         </View>
// //     );

// //     // üé® FlatList renderItem fonksiyonu: √ñƒürenci listesi
// //     const renderOgrenciItem = ({ item }) => (
// //         <TouchableOpacity
// //             style={styles.ogrenciItem}
// //             onPress={() => setShowOgrenciList(false)} // Modal'ƒ± kapat
// //         >
// //             {/* Template literal (`): string i√ßine deƒüi≈üken g√∂mme */}
// //             <Text style={styles.ogrenciText}>
// //                 {item.ogrenciAd} {item.ogrenciSoyad}
// //             </Text>
// //         </TouchableOpacity>
// //     );

// //     // üé® Takvim h√ºcresi render fonksiyonu
// //     // Bu fonksiyon hem ay hem hafta g√∂r√ºn√ºm√ºnde kullanƒ±lƒ±r
// //     const renderCalendarDay = (day, index) => {
// //         // String kar≈üƒ±la≈ütƒ±rmasƒ±: se√ßili g√ºn kontrol√º
// //         const isSelected = day.date.toDateString() === selectedDate.toDateString();
// //         const dayNumber = day.date.getDate(); // G√ºn√ºn sayƒ±sƒ± (1-31)

// //         return (
// //             <TouchableOpacity
// //                 key={index} // React'te liste elemanlarƒ± i√ßin unique key gerekli
// //                 style={[
// //                     styles.calendarDay,
// //                     // Conditional styling array: ko≈üullu stil ekleme
// //                     !day.isCurrentMonth && styles.nonCurrentMonthDay,
// //                     day.isToday && styles.today,
// //                     isSelected && styles.selectedDay, // En son gelen √ºstteki stilleri ezer
// //                 ]}
// //                 onPress={() => selectDay(day)} // Arrow function: parametre ge√ßmek i√ßin
// //             >
// //                 <Text
// //                     style={[
// //                         styles.dayText,
// //                         !day.isCurrentMonth && styles.nonCurrentMonthText,
// //                         day.isToday && styles.todayText,
// //                         isSelected && styles.selectedDayText,
// //                     ]}
// //                 >
// //                     {dayNumber}
// //                 </Text>
// //                 {/* Conditional rendering: etkinlik varsa nokta g√∂ster */}
// //                 {day.hasEvent && <View style={styles.eventDot} />}
// //             </TouchableOpacity>
// //         );
// //     };

// //     // ‚è≥ Loading durumu render'ƒ±
// //     // Component hen√ºz y√ºkleniyorsa bu ekranƒ± g√∂ster
// //     if (loading) {
// //         return (
// //             <View style={styles.centerContainer}>
// //                 <ActivityIndicator size="large" color="#3498db" />
// //                 <Text style={styles.loadingText}>Y√ºkleniyor...</Text>
// //             </View>
// //         );
// //     }

// //     // üñºÔ∏è Ana component render'ƒ±
// //     // JSX: JavaScript XML - React'te UI tanƒ±mlama syntaxƒ±
// //     return (
// //         <View style={styles.container}>
// //             {/* TAKVIM B√ñL√úM√ú */}
// //             <View style={styles.takvimContainer}>
// //                 {/* √úst bar: G√∂r√ºn√ºm switch'i ve ay/hafta navigasyonu */}
// //                 <View style={styles.ustBar}>
// //                     {/* Sol: G√∂r√ºn√ºm deƒüi≈ütirme switch'i */}
// //                     <View style={styles.switchContainer}>
// //                         <Text style={styles.switchLabel}>Ay</Text>
// //                         <Switch
// //                             value={isWeekView} // Switch'in a√ßƒ±k/kapalƒ± durumu
// //                             onValueChange={toggleView} // Deƒüi≈ütiƒüinde √ßaƒürƒ±lacak fonksiyon
// //                             trackColor={{ false: '#ecf0f1', true: '#3498db' }} // Track renkleri
// //                             thumbColor={isWeekView ? '#ffffff' : '#bdc3c7'} // Thumb rengi
// //                         />
// //                         <Text style={styles.switchLabel}>Hafta</Text>
// //                     </View>

// //                     {/* Saƒü: Bug√ºne git butonu */}
// //                     <TouchableOpacity
// //                         style={styles.bugunButton}
// //                         onPress={() => {
// //                             const today = new Date();
// //                             setSelectedDate(today);
// //                             if (isWeekView) {
// //                                 setCurrentWeek(getMonday(today));
// //                             } else {
// //                                 setCurrentMonth(new Date(today.getFullYear(), today.getMonth(), 1));
// //                             }
// //                         }}
// //                     >
// //                         <Text style={styles.bugunButtonText}>Bug√ºn</Text>
// //                     </TouchableOpacity>
// //                 </View>

// //                 {/* Ay/hafta navigasyonu */}
// //                 <View style={styles.ayNavigasyon}>
// //                     <TouchableOpacity
// //                         onPress={() => isWeekView ? changeWeek(-1) : changeMonth(-1)}
// //                         style={styles.navButton}
// //                     >
// //                         <MaterialIcons name="chevron-left" size={28} color="#2c3e50" />
// //                     </TouchableOpacity>

// //                     <Text style={styles.ayText}>
// //                         {isWeekView ? formatWeek(currentWeek) : formatMonth(currentMonth)}
// //                     </Text>

// //                     <TouchableOpacity
// //                         onPress={() => isWeekView ? changeWeek(1) : changeMonth(1)}
// //                         style={styles.navButton}
// //                     >
// //                         <MaterialIcons name="chevron-right" size={28} color="#2c3e50" />
// //                     </TouchableOpacity>
// //                 </View>

// //                 {/* G√ºn ba≈ülƒ±klarƒ± satƒ±rƒ± */}
// //                 <View style={styles.weekDaysContainer}>
// //                     {DAY_NAMES.map((name, i) => (
// //                         <Text key={i} style={styles.weekDayText}>
// //                             {name}
// //                         </Text>
// //                     ))}
// //                 </View>

// //                 {/* Takvim ƒ±zgarasƒ± */}
// //                 {/* flexWrap: 'wrap' - 7 elemandan sonra alt satƒ±ra ge√ß */}
// //                 <View style={styles.calendarGrid}>
// //                     {calendarDays.map((day, index) => renderCalendarDay(day, index))}
// //                 </View>

// //                 {/* Se√ßilen tarih bilgi kutusu */}
// //                 <View style={styles.selectedDateContainer}>
// //                     <Text style={styles.selectedDateText}>
// //                         {selectedDate.toLocaleDateString('tr-TR', {
// //                             weekday: 'long', // "Pazartesi"
// //                             day: 'numeric',  // "31"
// //                             month: 'long',   // "Aƒüustos"
// //                             year: 'numeric', // "2025"
// //                         })}
// //                     </Text>
// //                 </View>
// //             </View>

// //             {/* ORTA: Aksiyon butonlarƒ± */}
// //             <View style={styles.butonlarContainer}>
// //                 {/* Yeni Randevu - se√ßili tarihi prop olarak g√∂nder */}
// //                 <TouchableOpacity
// //                     style={[styles.ortaButon, { backgroundColor: '#3498db' }]}
// //                     onPress={() => navigation.navigate('AjandaKayitEkle', {
// //                         selectedDate: selectedDate.toISOString() // ISO string formatƒ±nda tarih g√∂nder
// //                     })}
// //                 >
// //                     <MaterialIcons name="add" size={20} color="white" />
// //                     <Text style={styles.ortaButonText}>Yeni Kayƒ±t</Text>
// //                 </TouchableOpacity>

// //                 <TouchableOpacity
// //                     style={[styles.ortaButon, { backgroundColor: '#e74c3c' }]}
// //                     onPress={() => setShowOgrenciList(true)}
// //                 >
// //                     <FontAwesome5 name="user-graduate" size={18} color="white" />
// //                     <Text style={styles.ortaButonText}>√ñƒürenciler</Text>
// //                 </TouchableOpacity>

// //                 <TouchableOpacity
// //                     style={[styles.ortaButon, { backgroundColor: '#2ecc71' }]}
// //                     onPress={() => navigation.navigate('AnaSayfa')}
// //                 >
// //                     <MaterialIcons name="home" size={20} color="white" />
// //                     <Text style={styles.ortaButonText}>Ana Sayfa</Text>
// //                 </TouchableOpacity>
// //             </View>

// //             {/* ALT: Randevu listesi */}
// //             <View style={styles.randevuListContainer}>
// //                 <Text style={styles.listeBaslik}>
// //                     {selectedDate.toLocaleDateString('tr-TR', { weekday: 'long' })} Randevularƒ±
// //                 </Text>

// //                 {/* Conditional rendering: randevu varsa liste, yoksa bo≈ü mesaj */}
// //                 {randevular.length > 0 ? (
// //                     <FlatList
// //                         data={randevular} // Render edilecek veri dizisi
// //                         renderItem={renderRandevuItem} // Her √∂ƒüe i√ßin render fonksiyonu
// //                         keyExtractor={(item) => item.id.toString()} // Unique key √ºretici
// //                         contentContainerStyle={styles.listeContent} // ƒ∞√ßerik container stili
// //                         showsVerticalScrollIndicator={false} // Scroll bar gizle
// //                     />
// //                 ) : (
// //                     <View style={styles.bosListe}>
// //                         <MaterialIcons name="event-busy" size={50} color="#ddd" />
// //                         <Text style={styles.bosListeText}>Bu tarihte randevu bulunmamaktadƒ±r</Text>
// //                     </View>
// //                 )}
// //             </View>

// //             {/* MODAL: √ñƒürenci listesi */}
// //             {/* Modal component: √ºst √ºste a√ßƒ±lan pencere */}
// //             <Modal
// //                 visible={showOgrenciList} // G√∂r√ºn√ºrl√ºk state'i
// //                 transparent={true} // Arka plan ≈üeffaf
// //                 animationType="fade" // A√ßƒ±lma animasyonu
// //                 onRequestClose={() => setShowOgrenciList(false)} // Android geri tu≈üu
// //             >
// //                 {/* TouchableWithoutFeedback: g√∂r√ºn√ºr feedback olmadan dokunma algƒ±lama */}
// //                 <TouchableWithoutFeedback onPress={() => setShowOgrenciList(false)}>
// //                     <View style={styles.modalOverlay}>
// //                         {/* ƒ∞√ß i√ße TouchableWithoutFeedback: i√ßeriƒüe tƒ±klayƒ±nca kapanmasƒ±n */}
// //                         <TouchableWithoutFeedback onPress={() => { }}>
// //                             <View style={styles.modalContent}>
// //                                 <Text style={styles.modalTitle}>
// //                                     √ñƒürenci Listesi ({ogrenciler.length} √∂ƒürenci)
// //                                 </Text>

// //                                 {ogrenciler.length > 0 ? (
// //                                     <FlatList
// //                                         data={ogrenciler}
// //                                         renderItem={renderOgrenciItem}
// //                                         keyExtractor={(item) => item.ogrenciId.toString()}
// //                                         contentContainerStyle={styles.modalList}
// //                                     />
// //                                 ) : (
// //                                     <Text style={styles.bosOgrenciText}>
// //                                         Kayƒ±tlƒ± √∂ƒürenci bulunamadƒ±
// //                                     </Text>
// //                                 )}
// //                             </View>
// //                         </TouchableWithoutFeedback>
// //                     </View>
// //                 </TouchableWithoutFeedback>
// //             </Modal>
// //         </View>
// //     );
// // }

// // // ------------------------------- STYLES --------------------------------------
// // // StyleSheet.create(): React Native'de stil tanƒ±mlama metodu
// // // CSS'e benzer ama React Native i√ßin optimize edilmi≈ü
// // // Stil objeleri JavaScript objesi formatƒ±nda yazƒ±lƒ±r

// // const styles = StyleSheet.create({
// //     // üì± Ana container - flex: 1 t√ºm ekranƒ± kaplar
// //     container: {
// //         flex: 1,
// //         backgroundColor: '#f8f9fa',
// //     },

// //     // ‚è≥ Y√ºklenme ekranƒ± merkezleme
// //     centerContainer: {
// //         flex: 1,
// //         justifyContent: 'center', // Dikey merkezleme
// //         alignItems: 'center',     // Yatay merkezleme
// //         backgroundColor: '#f8f9fa',
// //     },
// //     loadingText: {
// //         marginTop: 10,
// //         color: '#7f8c8d',
// //         fontSize: 14,
// //     },

// //     // üìÖ Takvim ana kutusu
// //     takvimContainer: {
// //         backgroundColor: 'white',
// //         padding: 15,
// //         borderBottomLeftRadius: 15,
// //         borderBottomRightRadius: 15,
// //         // Shadow (g√∂lge) √∂zellikleri - iOS ve Android i√ßin farklƒ±
// //         shadowColor: '#000',
// //         shadowOffset: { width: 0, height: 2 },
// //         shadowOpacity: 0.1,
// //         shadowRadius: 4,
// //         elevation: 3, // Android shadow
// //     },

// //     // üîù √úst bar: Switch ve bug√ºn butonu
// //     ustBar: {
// //         flexDirection: 'row',
// //         justifyContent: 'space-between',
// //         alignItems: 'center',
// //         marginBottom: 15,
// //     },

// //     // üîÄ Switch container ve label'larƒ±
// //     switchContainer: {
// //         flexDirection: 'row',
// //         alignItems: 'center',
// //     },
// //     switchLabel: {
// //         fontSize: 12,
// //         color: '#7f8c8d',
// //         marginHorizontal: 8,
// //         fontWeight: '500',
// //     },

// //     // üìç Bug√ºne git butonu
// //     bugunButton: {
// //         backgroundColor: '#ecf0f1',
// //         paddingHorizontal: 12,
// //         paddingVertical: 6,
// //         borderRadius: 15,
// //     },
// //     bugunButtonText: {
// //         fontSize: 12,
// //         color: '#2c3e50',
// //         fontWeight: '600',
// //     },

// //     // ‚¨ÖÔ∏è‚û°Ô∏è Ay/hafta navigasyon √ßubuƒüu
// //     ayNavigasyon: {
// //         flexDirection: 'row',
// //         justifyContent: 'space-between',
// //         alignItems: 'center',
// //         marginBottom: 15,
// //     },
// //     navButton: {
// //         padding: 5,
// //         borderRadius: 15,
// //     },
// //     ayText: {
// //         fontSize: 18,
// //         fontWeight: 'bold',
// //         color: '#2c3e50',
// //         textAlign: 'center',
// //         flex: 1, // Orta alanda maksimum yer kapla
// //     },

// //     // üìã Hafta g√ºnleri ba≈ülƒ±k satƒ±rƒ±
// //     weekDaysContainer: {
// //         flexDirection: 'row',
// //         justifyContent: 'space-around',
// //         marginBottom: 10,
// //         borderBottomWidth: 1,
// //         borderBottomColor: '#ecf0f1',
// //         paddingBottom: 5,
// //     },
// //     weekDayText: {
// //         fontSize: 12,
// //         fontWeight: '600',
// //         color: '#7f8c8d',
// //         width: CELL_WIDTH, // Hesaplanan h√ºcre geni≈üliƒüi
// //         textAlign: 'center',
// //     },

// //     // üóìÔ∏è Takvim ƒ±zgarasƒ± - flexWrap ile 7'den sonra alt satƒ±ra ge√ß
// //     calendarGrid: {
// //         flexDirection: 'row',
// //         flexWrap: 'wrap', // √ñnemli: 7 elemandan sonra sarma
// //         marginBottom: 15,
// //         justifyContent: 'space-between', // E≈üit daƒüƒ±tƒ±m
// //     },

// //     // üìÖ Tek bir takvim g√ºn√º h√ºcresi
// //     calendarDay: {
// //         width: CELL_WIDTH,
// //         height: 40,
// //         justifyContent: 'center',
// //         alignItems: 'center',
// //         marginVertical: 2,
// //         position: 'relative', // eventDot i√ßin absolute positioning
// //         borderRadius: 20,
// //     },

// //     // üîò Mevcut ay dƒ±≈üƒ±ndaki g√ºnler (soluk g√∂r√ºn√ºm)
// //     nonCurrentMonthDay: {
// //         opacity: 0.35
// //     },

// //     // üîµ Se√ßili g√ºn stili (mavi arkaplan)
// //     // Not: Bu stil today stilinden sonra geldiƒüi i√ßin √∂nceliƒüi var
// //     selectedDay: {
// //         backgroundColor: '#3498db',
// //     },

// //     // üî¥ Bug√ºn stili (kƒ±rmƒ±zƒ± √ßer√ßeve)
// //     today: {
// //         borderWidth: 2,
// //         borderColor: '#e74c3c',
// //     },

// //     // üìù G√ºn numarasƒ± text stilleri
// //     dayText: {
// //         fontSize: 14,
// //         color: '#2c3e50',
// //         fontWeight: '500',
// //     },
// //     nonCurrentMonthText: {
// //         color: '#bdc3c7'
// //     },
// //     selectedDayText: {
// //         color: 'white',
// //         fontWeight: 'bold',
// //     },
// //     todayText: {
// //         color: '#e74c3c',
// //         fontWeight: 'bold',
// //     },

// //     // üî¥ Etkinlik noktasƒ± (g√ºn√ºn altƒ±nda k√º√ß√ºk nokta)
// //     eventDot: {
// //         position: 'absolute',
// //         bottom: 2,
// //         width: 6,
// //         height: 6,
// //         borderRadius: 3,
// //         backgroundColor: '#e74c3c',
// //     },

// //     // üìã Se√ßili tarih bilgi kutusu
// //     selectedDateContainer: {
// //         alignItems: 'center',
// //         padding: 10,
// //         backgroundColor: '#ecf0f1',
// //         borderRadius: 10,
// //     },
// //     selectedDateText: {
// //         fontSize: 14,
// //         fontWeight: '600',
// //         color: '#2c3e50',
// //     },

// //     // üîò Orta butonlar container'ƒ±
// //     butonlarContainer: {
// //         flexDirection: 'row',
// //         justifyContent: 'space-between',
// //         padding: 15,
// //         backgroundColor: 'white',
// //         marginVertical: 10,
// //         marginHorizontal: 10,
// //         borderRadius: 15,
// //         shadowColor: '#000',
// //         shadowOffset: { width: 0, height: 2 },
// //         shadowOpacity: 0.1,
// //         shadowRadius: 4,
// //         elevation: 3,
// //     },
// //     ortaButon: {
// //         alignItems: 'center',
// //         justifyContent: 'center',
// //         width: 100,
// //         height: 40,
// //         borderRadius: 20,
// //         flexDirection: 'row', // ƒ∞kon ve text yan yana
// //     },
// //     ortaButonText: {
// //         color: 'white',
// //         fontWeight: '600',
// //         fontSize: 11,
// //         marginLeft: 4,
// //     },

// //     // üìù Randevu listesi b√∂l√ºm√º
// //     randevuListContainer: {
// //         flex: 1,
// //         padding: 15
// //     },
// //     listeBaslik: {
// //         fontSize: 16,
// //         fontWeight: 'bold',
// //         color: '#2c3e50',
// //         marginBottom: 10,
// //         textAlign: 'center',
// //     },
// //     listeContent: {
// //         paddingBottom: 20
// //     },

// //     // üìã Tek bir randevu kartƒ±
// //     randevuItem: {
// //         flexDirection: 'row',
// //         alignItems: 'center',
// //         backgroundColor: 'white',
// //         padding: 12,
// //         borderRadius: 8,
// //         marginBottom: 8,
// //         shadowColor: '#000',
// //         shadowOffset: { width: 0, height: 1 },
// //         shadowOpacity: 0.1,
// //         shadowRadius: 2,
// //         elevation: 2,
// //     },
// //     tamamlandiItem: {
// //         opacity: 0.7,
// //         backgroundColor: '#f8f9fa'
// //     },

// //     // ‚è∞ Randevu saat kutusu
// //     randevuSaat: {
// //         backgroundColor: '#3498db',
// //         padding: 8,
// //         borderRadius: 6,
// //         marginRight: 12,
// //         minWidth: 60,
// //         alignItems: 'center',
// //     },
// //     randevuSaatText: {
// //         color: 'white',
// //         fontWeight: 'bold',
// //         fontSize: 12
// //     },

// //     // üë§ Randevu bilgi alanƒ± (√∂ƒürenci adƒ± ve ders)
// //     randevuBilgi: {
// //         flex: 1 // Kalan alanƒ± kapla
// //     },
// //     randevuOgrenci: {
// //         fontSize: 14,
// //         fontWeight: '600',
// //         color: '#2c3e50',
// //         marginBottom: 2,
// //     },
// //     randevuDers: {
// //         fontSize: 12,
// //         color: '#7f8c8d'
// //     },
// //     randevuDurum: {
// //         marginLeft: 8
// //     },

// //     // üì≠ Bo≈ü liste g√∂sterimi
// //     bosListe: {
// //         alignItems: 'center',
// //         justifyContent: 'center',
// //         padding: 30
// //     },
// //     bosListeText: {
// //         marginTop: 10,
// //         color: '#95a5a6',
// //         textAlign: 'center',
// //         fontSize: 14
// //     },

// //     // ü™ü Modal stilleri
// //     modalOverlay: {
// //         flex: 1,
// //         backgroundColor: 'rgba(0, 0, 0, 0.5)', // Yarƒ± ≈üeffaf siyah
// //         justifyContent: 'center',
// //         alignItems: 'center',
// //     },
// //     modalContent: {
// //         backgroundColor: 'white',
// //         borderRadius: 15,
// //         padding: 20,
// //         width: '80%',
// //         maxHeight: '60%',
// //     },
// //     modalTitle: {
// //         fontSize: 16,
// //         fontWeight: 'bold',
// //         color: '#2c3e50',
// //         marginBottom: 12,
// //         textAlign: 'center',
// //     },
// //     modalList: {
// //         paddingBottom: 8
// //     },

// //     // üë§ Modal i√ßindeki √∂ƒürenci satƒ±rƒ±
// //     ogrenciItem: {
// //         padding: 12,
// //         borderBottomWidth: 1,
// //         borderBottomColor: '#ecf0f1'
// //     },
// //     ogrenciText: {
// //         fontSize: 14,
// //         color: '#2c3e50'
// //     },
// //     bosOgrenciText: {
// //         textAlign: 'center',
// //         color: '#95a5a6',
// //         fontStyle: 'italic',
// //         padding: 20
// //     },
// // });

// // // üì§ Default export: bu component'i ba≈üka dosyalarda import edebilmek i√ßin
// // // import Ajanda from './ajanda' ≈üeklinde kullanƒ±labilir

// // Ajanda.js
// // ===========================
// // Bu ekran, SQLite veritabanƒ±ndaki ajanda kayƒ±tlarƒ±nƒ± (randevu/etkinlik)
// // listelemek, eklemek, g√ºncellemek ve silmek i√ßin kullanƒ±lacak.
// // Ajanda verileri 'ajanda' tablosundan √ßekilir ve kullanƒ±cƒ±nƒ±n eklediƒüi kayƒ±tlarla g√ºncellenir.
// //
// // Kullanƒ±lan bile≈üenler:
// // - React hooks (useState, useEffect) : state y√∂netimi ve lifecycle
// // - FlatList : kayƒ±tlarƒ± listelemek
// // - Alert : kullanƒ±cƒ±ya onay veya uyarƒ± g√∂stermek
// // - ajandaDatabase.js : veritabanƒ± i≈ülemleri (CRUD fonksiyonlarƒ±)

// import React, { useState, useEffect } from "react";
// import { 
//   View, 
//   Text, 
//   FlatList, 
//   Button, 
//   Alert, 
//   StyleSheet, 
//   TouchableOpacity 
// } from "react-native";

// // Veritabanƒ± fonksiyonlarƒ±nƒ± import ediyoruz
// // Not: Bu dosya util/ klas√∂r√ºnde olacak
// import { 
//   getAjanda, 
//   addAjanda, 
//   updateAjanda, 
//   deleteAjanda 
// } from "../util/ajandaDatabase";

// export default function Ajanda() {
//   // Kayƒ±tlarƒ±n state‚Äôi
//   const [ajandaList, setAjandaList] = useState([]);

//   // Sayfa ilk a√ßƒ±ldƒ±ƒüƒ±nda ajanda kayƒ±tlarƒ±nƒ± y√ºkler
//   useEffect(() => {
//     loadAjanda();
//   }, []);

//   // Veritabanƒ±ndan kayƒ±tlarƒ± √ßekip state‚Äôe atayan fonksiyon
//   async function loadAjanda() {
//     try {
//       const data = await getAjanda(); // t√ºm kayƒ±tlarƒ± √ßek
//       setAjandaList(data);           // state‚Äôe at
//     } catch (error) {
//       console.error("Ajanda y√ºklenirken hata:", error);
//     }
//   }

//   // Yeni kayƒ±t eklemek i√ßin fonksiyon
//   async function handleAdd() {
//     try {
//       // ≈ûimdilik √∂rnek veri ekliyoruz.
//       // ƒ∞leride bu kƒ±sƒ±m formdan alƒ±nan kullanƒ±cƒ± girdileriyle deƒüi≈ütirilebilir.
//       await addAjanda({
//         ogrenciId: null,
//         isim: "Yeni Kayƒ±t", 
//         tarih: "2025-09-01", 
//         saat: "10:00"
//       });

//       // Eklemeden sonra listeyi g√ºncelle
//       loadAjanda();
//     } catch (error) {
//       console.error("Kayƒ±t eklenirken hata:", error);
//     }
//   }

//   // Kayƒ±t g√ºncelleme
//   async function handleUpdate(item) {
//     try {
//       // ƒ∞sim bilgisini g√ºncelliyoruz (√∂rnek ama√ßlƒ±)
//       await updateAjanda(item.id, {
//         ogrenciId: item.ogrenciId,
//         isim: item.isim + " (g√ºncellendi)",
//         tarih: item.tarih,
//         saat: item.saat
//       });

//       loadAjanda();
//     } catch (error) {
//       console.error("Kayƒ±t g√ºncellenirken hata:", error);
//     }
//   }

//   // Kayƒ±t silme
//   function handleDelete(id) {
//     // Kullanƒ±cƒ±dan silme i√ßin onay alƒ±yoruz
//     Alert.alert(
//       "Silme Onayƒ±",
//       "Bu kaydƒ± silmek istediƒüinizden emin misiniz?",
//       [
//         { text: "Vazge√ß", style: "cancel" },
//         { 
//           text: "Sil", 
//           style: "destructive",
//           onPress: async () => {
//             try {
//               await deleteAjanda(id);
//               loadAjanda();
//             } catch (error) {
//               console.error("Kayƒ±t silinirken hata:", error);
//             }
//           }
//         }
//       ]
//     );
//   }

//   // Her kayƒ±t i√ßin render edilecek bile≈üen
//   function renderItem({ item }) {
//     return (
//       <TouchableOpacity 
//         style={styles.item} 
//         onPress={() => handleUpdate(item)} // tƒ±klayƒ±nca g√ºncelle
//         onLongPress={() => handleDelete(item.id)} // uzun basƒ±nca sil
//       >
//         <Text style={styles.itemText}>
//           {item.tarih} - {item.saat} ‚Üí {item.isim}
//         </Text>
//       </TouchableOpacity>
//     );
//   }

//   return (
//     <View style={styles.container}>
//       <Text style={styles.title}>üìÖ Ajanda</Text>

//       {/* Kayƒ±t Ekleme Butonu */}
//       <Button title="Yeni Kayƒ±t Ekle" onPress={handleAdd} />

//       {/* Kayƒ±tlarƒ±n Listelenmesi */}
//       <FlatList
//         data={ajandaList}
//         keyExtractor={(item) => item.id.toString()}
//         renderItem={renderItem}
//       />
//     </View>
//   );
// }

// // ============================
// // STYLES
// // ============================
// // React Native'de CSS yerine StyleSheet kullanƒ±yoruz.
// // Nesne yapƒ±sƒ± i√ßinde key: value formatƒ± vardƒ±r.
// // Flexbox mantƒ±ƒüƒ± kullanƒ±lƒ±r.
// const styles = StyleSheet.create({
//   container: {
//     flex: 1,
//     padding: 16,
//     backgroundColor: "#f4f4f4",
//   },
//   title: {
//     fontSize: 22,
//     fontWeight: "bold",
//     marginBottom: 10,
//     textAlign: "center",
//   },
//   item: {
//     backgroundColor: "white",
//     padding: 12,
//     borderRadius: 8,
//     marginBottom: 8,
//     shadowColor: "#000",
//     shadowOpacity: 0.1,
//     shadowOffset: { width: 0, height: 2 },
//     shadowRadius: 4,
//     elevation: 3, // Android g√∂lge efekti
//   },
//   itemText: {
//     fontSize: 16,
//   },
// });


// ajanda.js (ger√ßek verilerle g√ºncellenmi≈ü s√ºr√ºm)
// -----------------------------------------------------------------------------
// Bu dosya, SQLite veritabanƒ±ndan ger√ßek ajanda verilerini √ßeker ve g√∂sterir.
// Hafta/ay g√∂r√ºn√ºm√º arasƒ±nda ge√ßi≈ü yapabilen, Pazartesi ba≈ülangƒ±√ßlƒ± takvim ƒ±zgarasƒ±
// ve √∂ƒürenci/randevu listeleri olan Ajanda ekranƒ±nƒ± i√ßerir.
// -----------------------------------------------------------------------------

import React, { useState, useEffect } from 'react';
import {
    View,
    Text,
    StyleSheet,
    ScrollView,
    TouchableOpacity,
    FlatList,
    Modal,
    TouchableWithoutFeedback,
    Dimensions,
    ActivityIndicator,
    Switch,
} from 'react-native';
import { useNavigation, useIsFocused } from '@react-navigation/native';
import { MaterialIcons, FontAwesome5 } from '@expo/vector-icons';
import { ogrencileriListele } from '../utils/database';
import { gunlukAjandaGetir, tumAjandaKayitlariniGetir } from '../utils/ajandaDatabase';
import { initDatabase } from '../utils/database';

// üìê Ekran geni≈üliƒüi hesaplamasƒ±
const { width } = Dimensions.get('window');
const CELL_WIDTH = (width - 30) / 7;

// üìÖ Haftanƒ±n g√ºn isimleri (Pazartesi ba≈ülangƒ±√ßlƒ±)
const DAY_NAMES = ['Pt', 'Sa', '√áa', 'Pe', 'Cu', 'Ct', 'Pz'];

// üîÑ JavaScript Date.getDay() d√∂n√º≈üt√ºr√ºc√º fonksiyon
const getDayIndex = (date) => {
    const jsDay = date.getDay();
    return jsDay === 0 ? 6 : jsDay - 1;
};

// üìÜ Verilen tarihten o haftanƒ±n Pazartesi'sini bulan fonksiyon
const getMonday = (date) => {
    const dayIndex = getDayIndex(date);
    const monday = new Date(date);
    monday.setDate(date.getDate() - dayIndex);
    return monday;
};

export default function Ajanda() {
    const navigation = useNavigation();
    const isFocused = useIsFocused();

    // üè™ React State (useState hook) tanƒ±mlamalarƒ±
    const [selectedDate, setSelectedDate] = useState(new Date());
    const [currentMonth, setCurrentMonth] = useState(new Date());
    const [currentWeek, setCurrentWeek] = useState(getMonday(new Date()));
    const [isWeekView, setIsWeekView] = useState(false);
    const [showOgrenciList, setShowOgrenciList] = useState(false);
    const [randevular, setRandevular] = useState([]);
    const [ogrenciler, setOgrenciler] = useState([]);
    const [calendarDays, setCalendarDays] = useState([]);
    const [loading, setLoading] = useState(true);

    // üîÑ useEffect Hook'larƒ±
    useEffect(() => {
        initDatabase();
        if (isWeekView) {
            generateWeekDays();
        } else {
            generateCalendarDaysMonth();
        }
    }, [currentMonth, currentWeek, isWeekView]);

    useEffect(() => {
        if (isFocused) {
            fetchOgrenciler();
            fetchRandevularForDate(selectedDate);
        }
    }, [isFocused]);

    useEffect(() => {
        fetchRandevularForDate(selectedDate);
    }, [selectedDate]);

    // üîó Asenkron fonksiyon: Veritabanƒ±ndan √∂ƒürenci listesi √ßekme
    const fetchOgrenciler = async () => {
        try {
            setLoading(true);
            const result = await ogrencileriListele(false);
            if (result?.success) {
                setOgrenciler(result.data || []);
            }
        } catch (error) {
            console.error('ajanda_√ñƒürenci listesi alƒ±namadƒ±:', error);
        } finally {
            setLoading(false);
        }
    };

    // üîó Asenkron fonksiyon: Se√ßilen tarihin randevularƒ±nƒ± √ßekme
    const fetchRandevularForDate = async (date) => {
        try {
            const secilengun = new Date(date);
            secilengun.setDate(date.getDate() + 1); //indis 0 ile ba≈üladƒ±ƒüƒ± i√ßin d√ºzeltme yapmak gerekti
            // Tarihi YYYY-MM-DD formatƒ±na √ßevir
            const formattedDate = secilengun.toISOString().split('T')[0];

            // Veritabanƒ±ndan randevularƒ± √ßek
            const randevuData = await gunlukAjandaGetir(formattedDate);

            // Veritabanƒ±ndan gelen randevularƒ± state'e set et
            setRandevular(randevuData.data || []);


        } catch (error) {
            console.error('ajanda_Randevular alƒ±namadƒ±:', error);
            setRandevular([]);
        }
    };

    // üìÖ AY G√ñR√úN√úM√ú: 42 h√ºcrelik takvim ƒ±zgarasƒ± olu≈üturma
    const generateCalendarDaysMonth = () => {
        const year = currentMonth.getFullYear();
        const month = currentMonth.getMonth();
        const firstDay = new Date(year, month, 1);
        const lastDay = new Date(year, month + 1, 0);
        const firstDayIndex = getDayIndex(firstDay);
        const days = [];
        const today = new Date();

        // 1Ô∏è‚É£ √ñNCEKƒ∞ AYDAN G√úNLER
        const prevMonthLastDate = new Date(year, month, 0).getDate();
        for (let i = firstDayIndex; i > 0; i--) {
            const date = new Date(year, month - 1, prevMonthLastDate - i + 1);
            days.push({
                date,
                isCurrentMonth: false,
                isToday: false,
                hasEvent: false, // Artƒ±k ger√ßek veri kullanacaƒüƒ±z
            });
        }

        // 2Ô∏è‚É£ BU AYDAN G√úNLER
        for (let d = 1; d <= lastDay.getDate(); d++) {
            const date = new Date(year, month, d);
            days.push({
                date,
                isCurrentMonth: true,
                isToday: date.toDateString() === today.toDateString(),
                hasEvent: false, // Artƒ±k ger√ßek veri kullanacaƒüƒ±z
            });
        }

        // 3Ô∏è‚É£ SONRAKƒ∞ AYDAN G√úNLER
        const totalCells = 42;
        const remainingCells = totalCells - days.length;
        for (let i = 1; i <= remainingCells; i++) {
            const date = new Date(year, month + 1, i);
            days.push({
                date,
                isCurrentMonth: false,
                isToday: false,
                hasEvent: false, // Artƒ±k ger√ßek veri kullanacaƒüƒ±z
            });
        }

        setCalendarDays(days);
    };

    // üìÖ HAFTA G√ñR√úN√úM√ú: 7 g√ºnl√ºk sƒ±ralƒ± liste olu≈üturma
    const generateWeekDays = () => {
        const days = [];
        const today = new Date();

        for (let i = 0; i < 7; i++) {
            const date = new Date(currentWeek);
            date.setDate(currentWeek.getDate() + i);

            days.push({
                date,
                isCurrentMonth: true,
                isToday: date.toDateString() === today.toDateString(),
                hasEvent: false, // Artƒ±k ger√ßek veri kullanacaƒüƒ±z
            });
        }

        setCalendarDays(days);
    };

    // üóìÔ∏è Ay formatlamasƒ± fonksiyonu
    const formatMonth = (date) =>
        date.toLocaleDateString('tr-TR', {
            month: 'long',
            year: 'numeric'
        });

    // üìÜ Hafta formatlamasƒ± fonksiyonu
    const formatWeek = (mondayDate) => {
        const sunday = new Date(mondayDate);
        sunday.setDate(mondayDate.getDate() + 6);

        if (mondayDate.getMonth() === sunday.getMonth()) {
            return `${mondayDate.getDate()}-${sunday.getDate()} ${formatMonth(mondayDate)}`;
        } else {
            return `${mondayDate.toLocaleDateString('tr-TR', { day: 'numeric', month: 'short' })} - ${sunday.toLocaleDateString('tr-TR', { day: 'numeric', month: 'short', year: 'numeric' })}`;
        }
    };

    // ‚¨ÖÔ∏è‚û°Ô∏è Ay deƒüi≈ütirme fonksiyonu
    const changeMonth = (direction) => {
        const nextMonth = new Date(currentMonth);
        nextMonth.setMonth(nextMonth.getMonth() + direction);
        setCurrentMonth(nextMonth);

        if (selectedDate.getMonth() !== nextMonth.getMonth() ||
            selectedDate.getFullYear() !== nextMonth.getFullYear()) {
            setSelectedDate(new Date(nextMonth.getFullYear(), nextMonth.getMonth(), 1));
        }
    };

    // ‚¨ÖÔ∏è‚û°Ô∏è Hafta deƒüi≈ütirme fonksiyonu
    const changeWeek = (direction) => {
        const nextWeek = new Date(currentWeek);
        nextWeek.setDate(currentWeek.getDate() + (direction * 7));
        setCurrentWeek(nextWeek);

        const newSelectedDate = new Date(selectedDate);
        newSelectedDate.setDate(selectedDate.getDate() + (direction * 7));
        setSelectedDate(newSelectedDate);
    };

    // üîÄ G√∂r√ºn√ºm deƒüi≈ütirme fonksiyonu
    const toggleView = (value) => {
        setIsWeekView(value);

        if (value) {
            setCurrentWeek(getMonday(selectedDate));
        } else {
            setCurrentMonth(new Date(selectedDate.getFullYear(), selectedDate.getMonth(), 1));
        }
    };

    // üëÜ G√ºn se√ßme fonksiyonu
    const selectDay = async (day) => {
        setSelectedDate(day.date);


        await fetchRandevularForDate(day.date);

    };

    // üé® FlatList renderItem fonksiyonu: Randevu listesi
    const renderRandevuItem = ({ item }) => {
        // sutun1 deƒüerine g√∂re durum belirleme
        const isCompleted = item.sutun1 === 'tamamlandƒ±';

        return (
            <TouchableOpacity
                onPress={() => navigation.navigate('AjandaRandevuDuzenle', { randevu: item })}>
                <View style={[
                    styles.randevuItem,
                    isCompleted && styles.tamamlandiItem
                ]}>
                    <View style={styles.randevuSaat}>
                        <Text style={styles.randevuSaatText}>{item.saat}</Text>
                    </View>

                    <View style={styles.randevuBilgi}>
                        <Text style={styles.randevuOgrenci}>{item.ogrAdsoyad}</Text>
                        {/* Ders bilgisi kaldƒ±rƒ±ldƒ± */}
                    </View>

                    <View style={styles.randevuDurum}>
                        {isCompleted ? (
                            <MaterialIcons name="check-circle" size={24} color="#27ae60" />
                        ) : (
                            <MaterialIcons name="schedule" size={24} color="#f39c12" />
                        )}
                    </View>
                </View></TouchableOpacity>
        );
    };

    // üé® FlatList renderItem fonksiyonu: √ñƒürenci listesi
    const renderOgrenciItem = ({ item }) => (
        <TouchableOpacity
            style={styles.ogrenciItem}
            onPress={() => setShowOgrenciList(false)}
        >
            <Text style={styles.ogrenciText}>
                {item.ogrenciAd} {item.ogrenciSoyad}
            </Text>
        </TouchableOpacity>
    );

    // üé® Takvim h√ºcresi render fonksiyonu
    const renderCalendarDay = (day, index) => {
        const isSelected = day.date.toDateString() === selectedDate.toDateString();
        const dayNumber = day.date.getDate();

        return (
            <TouchableOpacity
                key={index}
                style={[
                    styles.calendarDay,
                    !day.isCurrentMonth && styles.nonCurrentMonthDay,
                    day.isToday && styles.today,
                    isSelected && styles.selectedDay,
                ]}
                onPress={() => {
                    console.log("ajanda_se√ßilen g√ºn:", day.date);
                    selectDay(day)
                }
                }
            >
                <Text
                    style={[
                        styles.dayText,
                        !day.isCurrentMonth && styles.nonCurrentMonthText,
                        day.isToday && styles.todayText,
                        isSelected && styles.selectedDayText,
                    ]}
                >
                    {dayNumber}
                </Text>
                {/* Etkinlik noktasƒ± kaldƒ±rƒ±ldƒ± - ger√ßek veri kullanƒ±mƒ± i√ßin */}
            </TouchableOpacity>
        );
    };

    // ‚è≥ Loading durumu render'ƒ±
    if (loading) {
        return (
            <View style={styles.centerContainer}>
                <ActivityIndicator size="large" color="#3498db" />
                <Text style={styles.loadingText}>Y√ºkleniyor...</Text>
            </View>
        );
    }

    // üñºÔ∏è Ana component render'ƒ±
    return (
        <View style={styles.container}>
            {/* TAKVIM B√ñL√úM√ú */}
            <View style={styles.takvimContainer}>
                <View style={styles.ustBar}>
                    <View style={styles.switchContainer}>
                        <Text style={styles.switchLabel}>Ay</Text>
                        <Switch
                            value={isWeekView}
                            onValueChange={toggleView}
                            trackColor={{ false: '#ecf0f1', true: '#3498db' }}
                            thumbColor={isWeekView ? '#ffffff' : '#bdc3c7'}
                        />
                        <Text style={styles.switchLabel}>Hafta</Text>
                    </View>

                    <TouchableOpacity
                        style={styles.bugunButton}
                        onPress={() => {
                            const today = new Date();
                            setSelectedDate(today);
                            if (isWeekView) {
                                setCurrentWeek(getMonday(today));
                            } else {
                                setCurrentMonth(new Date(today.getFullYear(), today.getMonth(), 1));
                            }
                        }}
                    >
                        <Text style={styles.bugunButtonText}>Bug√ºn</Text>
                    </TouchableOpacity>
                </View>

                <View style={styles.ayNavigasyon}>
                    <TouchableOpacity
                        onPress={() => isWeekView ? changeWeek(-1) : changeMonth(-1)}
                        style={styles.navButton}
                    >
                        <MaterialIcons name="chevron-left" size={28} color="#2c3e50" />
                    </TouchableOpacity>

                    <Text style={styles.ayText}>
                        {isWeekView ? formatWeek(currentWeek) : formatMonth(currentMonth)}
                    </Text>

                    <TouchableOpacity
                        onPress={() => isWeekView ? changeWeek(1) : changeMonth(1)}
                        style={styles.navButton}
                    >
                        <MaterialIcons name="chevron-right" size={28} color="#2c3e50" />
                    </TouchableOpacity>
                </View>

                <View style={styles.weekDaysContainer}>
                    {DAY_NAMES.map((name, i) => (
                        <Text key={i} style={styles.weekDayText}>
                            {name}
                        </Text>
                    ))}
                </View>

                <View style={styles.calendarGrid}>
                    {calendarDays.map((day, index) => renderCalendarDay(day, index))}
                </View>

                <View style={styles.selectedDateContainer}>
                    <Text style={styles.selectedDateText}>
                        {selectedDate.toLocaleDateString('tr-TR', {
                            weekday: 'long',
                            day: 'numeric',
                            month: 'long',
                            year: 'numeric',
                        })}
                    </Text>
                </View>
            </View>

            {/* ORTA: Aksiyon butonlarƒ± */}
            <View style={styles.butonlarContainer}>
                <TouchableOpacity
                    style={[styles.ortaButon, { backgroundColor: '#3498db' }]}
                    onPress={() => navigation.navigate('AjandaKayitEkle', {
                        selectedDate: selectedDate.toISOString()
                    })}
                >
                    <MaterialIcons name="add" size={20} color="white" />
                    <Text style={styles.ortaButonText}>Yeni Kayƒ±t</Text>
                </TouchableOpacity>

                <TouchableOpacity
                    style={[styles.ortaButon, { backgroundColor: '#e74c3c' }]}
                    onPress={() => setShowOgrenciList(true)}
                >
                    <FontAwesome5 name="user-graduate" size={18} color="white" />
                    <Text style={styles.ortaButonText}>√ñƒürenciler</Text>
                </TouchableOpacity>

                <TouchableOpacity
                    style={[styles.ortaButon, { backgroundColor: '#2ecc71' }]}
                    onPress={() => navigation.navigate('AnaSayfa')}
                >
                    <MaterialIcons name="home" size={20} color="white" />
                    <Text style={styles.ortaButonText}>Ana Sayfa</Text>
                </TouchableOpacity>
            </View>

            {/* ALT: Randevu listesi */}
            <View style={styles.randevuListContainer}>
                <Text style={styles.listeBaslik}>
                    {selectedDate.toLocaleDateString('tr-TR', { weekday: 'long' })} Randevularƒ±
                </Text>

                {randevular.length > 0 ? (
                    <FlatList
                        data={randevular}
                        renderItem={renderRandevuItem}
                        keyExtractor={(item) => item.ajandaId.toString()}
                        contentContainerStyle={styles.listeContent}
                        showsVerticalScrollIndicator={false}
                    />
                ) : (
                    <View style={styles.bosListe}>
                        <MaterialIcons name="event-busy" size={50} color="#ddd" />
                        <Text style={styles.bosListeText}>Bu tarihte randevu bulunmamaktadƒ±r</Text>
                    </View>
                )}
            </View>

            {/* MODAL: √ñƒürenci listesi */}
            <Modal
                visible={showOgrenciList}
                transparent={true}
                animationType="fade"
                onRequestClose={() => setShowOgrenciList(false)}
            >
                <TouchableWithoutFeedback onPress={() => setShowOgrenciList(false)}>
                    <View style={styles.modalOverlay}>
                        <TouchableWithoutFeedback onPress={() => { }}>
                            <View style={styles.modalContent}>
                                <Text style={styles.modalTitle}>
                                    √ñƒürenci Listesi ({ogrenciler.length} √∂ƒürenci)
                                </Text>

                                {ogrenciler.length > 0 ? (
                                    <FlatList
                                        data={ogrenciler}
                                        renderItem={renderOgrenciItem}
                                        keyExtractor={(item) => item.ogrenciId.toString()}
                                        contentContainerStyle={styles.modalList}
                                    />
                                ) : (
                                    <Text style={styles.bosOgrenciText}>
                                        Kayƒ±tlƒ± √∂ƒürenci bulunamadƒ±
                                    </Text>
                                )}
                            </View>
                        </TouchableWithoutFeedback>
                    </View>
                </TouchableWithoutFeedback>
            </Modal>
        </View>
    );
}

// ------------------------------- STYLES --------------------------------------
const styles = StyleSheet.create({
    container: {
        flex: 1,
        backgroundColor: '#f8f9fa',
    },
    centerContainer: {
        flex: 1,
        justifyContent: 'center',
        alignItems: 'center',
        backgroundColor: '#f8f9fa',
    },
    loadingText: {
        marginTop: 10,
        color: '#7f8c8d',
        fontSize: 14,
    },
    takvimContainer: {
        backgroundColor: 'white',
        padding: 15,
        borderBottomLeftRadius: 15,
        borderBottomRightRadius: 15,
        shadowColor: '#000',
        shadowOffset: { width: 0, height: 2 },
        shadowOpacity: 0.1,
        shadowRadius: 4,
        elevation: 3,
    },
    ustBar: {
        flexDirection: 'row',
        justifyContent: 'space-between',
        alignItems: 'center',
        marginBottom: 15,
    },
    switchContainer: {
        flexDirection: 'row',
        alignItems: 'center',
    },
    switchLabel: {
        fontSize: 12,
        color: '#7f8c8d',
        marginHorizontal: 8,
        fontWeight: '500',
    },
    bugunButton: {
        backgroundColor: '#ecf0f1',
        paddingHorizontal: 12,
        paddingVertical: 6,
        borderRadius: 15,
    },
    bugunButtonText: {
        fontSize: 12,
        color: '#2c3e50',
        fontWeight: '600',
    },
    ayNavigasyon: {
        flexDirection: 'row',
        justifyContent: 'space-between',
        alignItems: 'center',
        marginBottom: 15,
    },
    navButton: {
        padding: 5,
        borderRadius: 15,
    },
    ayText: {
        fontSize: 18,
        fontWeight: 'bold',
        color: '#2c3e50',
        textAlign: 'center',
        flex: 1,
    },
    weekDaysContainer: {
        flexDirection: 'row',
        justifyContent: 'space-around',
        marginBottom: 10,
        borderBottomWidth: 1,
        borderBottomColor: '#ecf0f1',
        paddingBottom: 5,
    },
    weekDayText: {
        fontSize: 12,
        fontWeight: '600',
        color: '#7f8c8d',
        width: CELL_WIDTH,
        textAlign: 'center',
    },
    calendarGrid: {
        flexDirection: 'row',
        flexWrap: 'wrap',
        marginBottom: 15,
        justifyContent: 'space-between',
    },
    calendarDay: {
        width: CELL_WIDTH,
        height: 40,
        justifyContent: 'center',
        alignItems: 'center',
        marginVertical: 2,
        position: 'relative',
        borderRadius: 20,
    },
    nonCurrentMonthDay: {
        opacity: 0.35
    },
    selectedDay: {
        backgroundColor: '#3498db',
    },
    today: {
        borderWidth: 2,
        borderColor: '#e74c3c',
    },
    dayText: {
        fontSize: 14,
        color: '#2c3e50',
        fontWeight: '500',
    },
    nonCurrentMonthText: {
        color: '#bdc3c7'
    },
    selectedDayText: {
        color: 'white',
        fontWeight: 'bold',
    },
    todayText: {
        color: '#e74c3c',
        fontWeight: 'bold',
    },
    selectedDateContainer: {
        alignItems: 'center',
        padding: 10,
        backgroundColor: '#ecf0f1',
        borderRadius: 10,
    },
    selectedDateText: {
        fontSize: 14,
        fontWeight: '600',
        color: '#2c3e50',
    },
    butonlarContainer: {
        flexDirection: 'row',
        justifyContent: 'space-between',
        padding: 15,
        backgroundColor: 'white',
        marginVertical: 10,
        marginHorizontal: 10,
        borderRadius: 15,
        shadowColor: '#000',
        shadowOffset: { width: 0, height: 2 },
        shadowOpacity: 0.1,
        shadowRadius: 4,
        elevation: 3,
    },
    ortaButon: {
        alignItems: 'center',
        justifyContent: 'center',
        width: 100,
        height: 40,
        borderRadius: 20,
        flexDirection: 'row',
    },
    ortaButonText: {
        color: 'white',
        fontWeight: '600',
        fontSize: 11,
        marginLeft: 4,
    },
    randevuListContainer: {
        flex: 1,
        padding: 15
    },
    listeBaslik: {
        fontSize: 16,
        fontWeight: 'bold',
        color: '#2c3e50',
        marginBottom: 10,
        textAlign: 'center',
    },
    listeContent: {
        paddingBottom: 20
    },
    randevuItem: {
        flexDirection: 'row',
        alignItems: 'center',
        backgroundColor: 'white',
        padding: 12,
        borderRadius: 8,
        marginBottom: 8,
        shadowColor: '#000',
        shadowOffset: { width: 0, height: 1 },
        shadowOpacity: 0.1,
        shadowRadius: 2,
        elevation: 2,
    },
    tamamlandiItem: {
        opacity: 0.7,
        backgroundColor: '#f8f9fa'
    },
    randevuSaat: {
        backgroundColor: '#3498db',
        padding: 8,
        borderRadius: 6,
        marginRight: 12,
        minWidth: 60,
        alignItems: 'center',
    },
    randevuSaatText: {
        color: 'white',
        fontWeight: 'bold',
        fontSize: 12
    },
    randevuBilgi: {
        flex: 1
    },
    randevuOgrenci: {
        fontSize: 14,
        fontWeight: '600',
        color: '#2c3e50',
        marginBottom: 2,
    },
    randevuDurum: {
        marginLeft: 8
    },
    bosListe: {
        alignItems: 'center',
        justifyContent: 'center',
        padding: 30
    },
    bosListeText: {
        marginTop: 10,
        color: '#95a5a6',
        textAlign: 'center',
        fontSize: 14
    },
    modalOverlay: {
        flex: 1,
        backgroundColor: 'rgba(0, 0, 0, 0.5)',
        justifyContent: 'center',
        alignItems: 'center',
    },
    modalContent: {
        backgroundColor: 'white',
        borderRadius: 15,
        padding: 20,
        width: '80%',
        maxHeight: '60%',
    },
    modalTitle: {
        fontSize: 16,
        fontWeight: 'bold',
        color: '#2c3e50',
        marginBottom: 12,
        textAlign: 'center',
    },
    modalList: {
        paddingBottom: 8
    },
    ogrenciItem: {
        padding: 12,
        borderBottomWidth: 1,
        borderBottomColor: '#ecf0f1'
    },
    ogrenciText: {
        fontSize: 14,
        color: '#2c3e50'
    },
    bosOgrenciText: {
        textAlign: 'center',
        color: '#95a5a6',
        fontStyle: 'italic',
        padding: 20
    },
});